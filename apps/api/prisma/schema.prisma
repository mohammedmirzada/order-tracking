generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

/**
 * Career-standard enums:
 * - Prevent random strings in status
 * - Easy filtering in API + UI
 */
enum OrderStatus {
  DRAFT
  PLACED
  DISPATCHED
  IN_TRANSIT
  DELIVERED
  CANCELED
}

/**
 * Auth / Users (simple + standard)
 * - Store hashed password (never plain)
 * - role can be ADMIN/USER if you want later
 */
model User {
  id        String   @id @default(uuid()) @db.Uuid
  email     String   @unique
  password  String
  name      String?
  role      String   @default("ADMIN")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}

model Supplier {
  id        String   @id @default(uuid()) @db.Uuid
  name      String

  orders    Order[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("suppliers")
  @@index([name])
}

model Forwarder {
  id        String   @id @default(uuid()) @db.Uuid
  name      String

  orders    Order[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("forwarders")
  @@index([name])
}

model Order {
  id                     String      @id @default(uuid()) @db.Uuid
  refNumber              String      @unique @map("ref_number")

  supplierId             String      @db.Uuid @map("supplier_id")
  supplier               Supplier    @relation(fields: [supplierId], references: [id], onDelete: Restrict)

  forwarderId            String?     @db.Uuid @map("forwarder_id")
  forwarder              Forwarder?  @relation(fields: [forwarderId], references: [id], onDelete: SetNull)

  status                 OrderStatus @default(DRAFT)
  orderDate              DateTime?   @map("order_date")
  dispatchDate           DateTime?   @map("dispatch_date")
  estimatedDeliveryDate  DateTime?   @map("estimated_delivery_date")
  actualDeliveryDate     DateTime?   @map("actual_delivery_date")

  shipmentName           String?     @map("shipment_name")
  comments               String?

  items                  OrderItem[]
  invoices               Invoice[]

  createdAt              DateTime    @default(now()) @map("created_at")
  updatedAt              DateTime    @updatedAt @map("updated_at")

  @@map("orders")
  @@index([supplierId])
  @@index([forwarderId])
  @@index([status])
  @@index([createdAt])
}

model OrderItem {
  id        String   @id @default(uuid()) @db.Uuid

  orderId   String   @db.Uuid @map("order_id")
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  sku       String?
  itemName  String   @map("item_name")
  quantity  Int
  price     Decimal  @db.Decimal(12, 2)
  total     Decimal  @db.Decimal(12, 2)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("order_items")
  @@index([orderId])
  @@index([sku])
}

model Invoice {
  id            String   @id @default(uuid()) @db.Uuid

  orderId       String   @db.Uuid @map("order_id")
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  invoiceNumber String   @map("invoice_number")
  invoiceDate   DateTime? @map("invoice_date")

  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@map("invoices")
  @@index([orderId])
  @@index([invoiceNumber])

  // If you want 1-to-1 instead of 1-to-many:
  // @@unique([orderId])
}